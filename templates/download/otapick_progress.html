{% load static %}
{% load bootstrap4 %}

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>画像取得中｜ヲタピック</title>

    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    <link href="{% static 'css/simple-line-icons.css'%}" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet"
        type="text/css">

    <link href="{% static 'css/bootstrap-ex.min.css'%}" rel="stylesheet">
</head>
<body>
    <div class="position-absolute h-100 w-100 m-0 d-flex align-items-center justify-content-center">
        <div class="container text-center">
            <img src="{% static 'img/otapick.png' %}" class="img-fluid mb-5 col-lg-5 col-md-8 col-8" alt="Responsive image">
            <h3>「{% if title %}{{ title }}{% endif %}」に含まれる画像を取得中です。</h3>
            <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" id="progress" role="progressbar"
                    aria-valuenow="{{ progress.num }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ progress.num }}%">
                </div>
            </div>
        </div>
    </div>

{#    #}
{#    <div class="container mt-5">#}
{#        {% if not progress.num >= 100 %}#}
{#          <div class="progress">#}
{#            <div class="progress-bar progress-bar-striped progress-bar-animated" id="progress" role="progressbar" aria-valuenow="{{ progress.num }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ progress.num }}%"></div>#}
{#          </div>#}
{#        {% endif %}#}
{#    </div>#}

    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <script>
        function reload() {
            jQuery(function($) {
                $.ajax({
                  url: "{% url 'download:download' group_id blog_ct %}",
                  method: 'get',
                  timeout: 10000,
                    datatype: 'text',
                })
                .done( function(data) {
                  $('#progress').css('width', data+'%').attr('aria-valuenow', data);
                  if(parseInt(data) >= 100){
                      setTimeout(function(){
                          window.location.href = "{% url 'download:download' group_id blog_ct %}"
                      },500);
                  }
                });
              setTimeout(function() {reload()},1000);
            });
        }
        reload();
    </script>
</body>
</html>