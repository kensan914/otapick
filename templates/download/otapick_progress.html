{% load static %}
{% load bootstrap4 %}

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>画像取得中｜ヲタピック</title>

    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    <link href="{% static 'css/simple-line-icons.css'%}" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet"
        type="text/css">

    <link href="{% static 'css/bootstrap-ex.min.css'%}" rel="stylesheet">

    <!-- twemoji -->
  <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js" crossorigin="anonymous"></script>
  <style>img.emoji { height: 1em; width: 1em; margin: 0 .05em 0 .1em; vertical-align: -0.1em;}</style>

    <!-- favicon -->
    <link rel="shortcut icon" type="image/png" href="{% static 'favicon.ico' %}"/>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134426000-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-134426000-2');
    </script>
</head>
<body>
  <div class="position-absolute h-100 w-100 m-0 d-flex align-items-center justify-content-center">
    <div class="container text-center px-0 mx-0">
      <h2 class="ml-5">Now Loading...</h2>

      <div class="write_box">
        <div class="img-wrap">
          <img src="{% static 'img/otapick_logo_back.png' %}" class="img-fluid mb-5 col-lg-5 col-md-8 col-11"
               alt="Responsive image">
        </div>

        <div class="img-wrap-before">
        </div>
      </div>

      <h3>「{% if title %}{{ title }}{% endif %}」に含まれる画像を取得中です。</h3>
      <div class="progress">
        {% if status == 'download' %}
        <div class="progress-bar" id="progress" role="progressbar" aria-valuenow="{{ progress.num }}"
             aria-valuemin="0" aria-valuemax="100" style="width: {{ progress.num }}%">
        </div>
        {% else %}
        <div class="progress-bar" id="progress" role="progressbar" aria-valuenow="0"
              aria-valuemin="0" aria-valuemax="100" style="width: 0">
        </div>
        {% endif %}
      </div>
    </div>
  </div>

    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    
    <script>
      function reload() {
        {% if status == 'download' %}
        jQuery(function ($) {
            $.ajax({
                url: "{% url 'download:download' group_id blog_ct %}",
                method: 'get',
                timeout: 10000,
                datatype: 'text',
            })
                .done(function (data) {
                    $('#progress').css('width', data + '%').attr('aria-valuenow', data);
                    if (parseInt(data) >= 100) {
                        setTimeout(function () {
                            window.location.href = "{% url 'download:download' group_id blog_ct %}"
                        }, 500);
                    }
                });
            setTimeout(function () { reload() }, 1000);
        });
        {% else %}
        jQuery(function ($) {
            $('#progress').css('width', 100 + '%').attr('aria-valuenow', 100);
            setTimeout(function () {
                window.location.href = "{% url 'download:download' group_id blog_ct %}"
            }, 600);
        });
        {% endif %}
    }
    reload();
    </script>

    <!-- twemoji -->
    <script>
      twemoji.parse(document.body);
    </script>

</body>
</html>
