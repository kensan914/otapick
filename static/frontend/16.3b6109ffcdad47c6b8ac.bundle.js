(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"./src/pages/ImageViewPage.jsx":
/*!*************************************************!*\
  !*** ./src/pages/ImageViewPage.jsx + 1 modules ***!
  \*************************************************/
/*! exports provided: default */
/*! all exports used */
/*! ModuleConcatenation bailout: Cannot concat with ./src/components/atoms/BackButton.jsx */
/*! ModuleConcatenation bailout: Cannot concat with ./src/components/molecules/Headline.jsx */
/*! ModuleConcatenation bailout: Cannot concat with ./src/components/organisms/ImageView.jsx */
/*! ModuleConcatenation bailout: Cannot concat with ./src/components/templates/ImageListTemplate/organisms/ImageList.jsx */
/*! ModuleConcatenation bailout: Cannot concat with ./src/contexts/DomContext.jsx */
/*! ModuleConcatenation bailout: Cannot concat with ./src/hooks/useAxios.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/hooks/useCacheRoute.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/hooks/useMeta.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/hooks/useView.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/index.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/react-cookie/es6/index.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/react-router/esm/react-router.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/react/index.js (<- Module is not an ECMAScript module) */function(module,__webpack_exports__,__webpack_require__){"use strict";eval('// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: ./node_modules/react/index.js\nvar react = __webpack_require__("./node_modules/react/index.js");\nvar react_default = /*#__PURE__*/__webpack_require__.n(react);\n\n// EXTERNAL MODULE: ./node_modules/react-cookie/es6/index.js + 8 modules\nvar es6 = __webpack_require__("./node_modules/react-cookie/es6/index.js");\n\n// EXTERNAL MODULE: ./node_modules/react-router/esm/react-router.js\nvar react_router = __webpack_require__("./node_modules/react-router/esm/react-router.js");\n\n// EXTERNAL MODULE: ./src/contexts/DomContext.jsx + 5 modules\nvar DomContext = __webpack_require__("./src/contexts/DomContext.jsx");\n\n// EXTERNAL MODULE: ./src/hooks/useAxios.js\nvar useAxios = __webpack_require__("./src/hooks/useAxios.js");\n\n// EXTERNAL MODULE: ./src/hooks/useCacheRoute.js\nvar useCacheRoute = __webpack_require__("./src/hooks/useCacheRoute.js");\n\n// EXTERNAL MODULE: ./src/utils/index.js\nvar utils = __webpack_require__("./src/utils/index.js");\n\n// EXTERNAL MODULE: ./src/components/organisms/ImageView.jsx + 1 modules\nvar ImageView = __webpack_require__("./src/components/organisms/ImageView.jsx");\n\n// EXTERNAL MODULE: ./src/components/templates/ImageListTemplate/organisms/ImageList.jsx\nvar ImageList = __webpack_require__("./src/components/templates/ImageListTemplate/organisms/ImageList.jsx");\n\n// EXTERNAL MODULE: ./src/components/atoms/BackButton.jsx\nvar BackButton = __webpack_require__("./src/components/atoms/BackButton.jsx");\n\n// EXTERNAL MODULE: ./src/components/molecules/Headline.jsx\nvar Headline = __webpack_require__("./src/components/molecules/Headline.jsx");\n\n// CONCATENATED MODULE: ./src/components/templates/ImageViewTemplate.jsx\n\n\n\n\n\n\n\nconst ImageViewTemplate = props => {\n  const {\n    groupId,\n    blogCt,\n    order,\n    groupKey,\n    imageId,\n    images,\n    blog,\n    status,\n    isReadyView,\n    requestPutDownloadOnlyMobile,\n    incrementNumOfDownloads,\n    prevSrcCollection\n  } = props;\n  return /*#__PURE__*/react_default.a.createElement(react_default.a.Fragment, null, utils["r" /* isMobile */] && /*#__PURE__*/react_default.a.createElement(Headline["a" /* default */], {\n    title: `画像詳細`\n  }), !utils["r" /* isMobile */] && /*#__PURE__*/react_default.a.createElement(BackButton["a" /* default */], {\n    fixed: true,\n    className: "in-image-view"\n  }), /*#__PURE__*/react_default.a.createElement(ImageView["a" /* default */], {\n    groupId: groupId,\n    blogCt: blogCt,\n    order: order,\n    groupKey: groupKey,\n    imageId: imageId,\n    images: images,\n    blog: blog,\n    status: status,\n    isReadyView: isReadyView,\n    requestPutDownloadOnlyMobile: requestPutDownloadOnlyMobile,\n    incrementNumOfDownloads: incrementNumOfDownloads,\n    prevSrcCollection: prevSrcCollection\n  }), /*#__PURE__*/react_default.a.createElement("div", {\n    className: "container-fluid text-muted mt-3 list-container-fluid"\n  }, /*#__PURE__*/react_default.a.createElement(ImageList["b" /* default */], {\n    type: "RELATED_IMAGES",\n    topComponent: /*#__PURE__*/react_default.a.createElement("h3", {\n      className: "text-center related-image-title " + (utils["t" /* isSmp */] ? "mt-2" : "")\n    }, "\\u95A2\\u9023\\u753B\\u50CF")\n  })));\n};\n\n/* harmony default export */ var templates_ImageViewTemplate = (ImageViewTemplate);\n// EXTERNAL MODULE: ./src/hooks/useView.js\nvar useView = __webpack_require__("./src/hooks/useView.js");\n\n// EXTERNAL MODULE: ./src/hooks/useMeta.js\nvar useMeta = __webpack_require__("./src/hooks/useMeta.js");\n\n// CONCATENATED MODULE: ./src/pages/ImageViewPage.jsx\n\n\n\n\n\n\n\n\n\n\n\nconst ImageViewPage = props => {\n  const {\n    cookies\n  } = props;\n  const {\n    isCachedRoute\n  } = Object(useCacheRoute["a" /* useCacheRoute */])();\n  const csrftoken = cookies.get("csrftoken");\n  const domState = Object(DomContext["d" /* useDomState */])();\n  const domDispatch = Object(DomContext["c" /* useDomDispatch */])();\n  const location = Object(react_router["l" /* useLocation */])();\n  const {\n    groupId,\n    blogCt,\n    order,\n    groupKey\n  } = Object(useView["b" /* useViewMatchParams */])();\n  const {\n    imageApiUrl,\n    blogApiUrl\n  } = Object(useView["d" /* useViewUrl */])(groupId, blogCt, order);\n  const [imageId] = Object(react["useState"])(`${groupId}-${blogCt}-${order}`);\n  const [accessedImageId] = Object(react["useState"])(`${imageId}.${Object(utils["k" /* generateUuid4 */])()}`);\n  const prevSrcCollection = typeof location.state !== "undefined" ? location.state.prevSrc : null;\n  const {\n    setMeta\n  } = Object(useMeta["a" /* useMeta */])();\n\n  const setMetaVerView = (status, blogTitle, blogWriter) => {\n    if (status === "success") {\n      setMeta(`${blogTitle}(${blogWriter})｜画像詳細`, `${blogWriter}のブログ「${blogTitle}」の画像です。`);\n    } else if (status === "blog_not_found") {\n      setMeta("Not Found Blog", "");\n    }\n  };\n\n  const [images, setImages, blog, status, viewKey, downloadKey, isReadyView] = Object(useView["a" /* useView */])(blogApiUrl, setMetaVerView, order);\n  const {\n    incrementNumOfViews,\n    incrementNumOfDownloads\n  } = Object(useView["c" /* useViewNum */])(images, setImages);\n  const {\n    request: requestPutView\n  } = Object(useAxios["c" /* useAxios */])(imageApiUrl, "put", {\n    data: {\n      action: "view",\n      key: viewKey\n    },\n    csrftoken: csrftoken,\n    thenCallback: res => {\n      if (res.data["status"] == "success") {\n        incrementNumOfViews(order);\n      }\n    },\n    limitRequest: 1 // 再送防止\n\n  });\n  const {\n    request: requestPutDownloadOnlyMobile\n  } = Object(useAxios["c" /* useAxios */])(imageApiUrl, "put", {\n    data: {\n      action: "download",\n      key: downloadKey\n    },\n    csrftoken: csrftoken,\n    thenCallback: res => {\n      if (res.data["status"] == "success") {\n        incrementNumOfDownloads(order);\n      }\n    }\n  });\n  Object(react["useEffect"])(() => {\n    // image viewの準備ができた\n    if (!isCachedRoute && isReadyView) {\n      var _blog$writer;\n\n      if (!domState.accessedImages.includes(accessedImageId)) {\n        requestPutView();\n        domDispatch({\n          type: "ACCESS_TO_IMAGE",\n          imageId: accessedImageId\n        });\n      }\n\n      if (blog !== null && blog !== void 0 && (_blog$writer = blog.writer) !== null && _blog$writer !== void 0 && _blog$writer.name) {\n        // update meta\n        setMetaVerView(status, blog.title, blog.writer.name);\n      }\n    }\n  }, [isCachedRoute, isReadyView]);\n  return /*#__PURE__*/react_default.a.createElement(templates_ImageViewTemplate, {\n    groupId: groupId,\n    blogCt: blogCt,\n    order: order,\n    groupKey: groupKey,\n    imageId: imageId,\n    images: images,\n    blog: blog,\n    status: status,\n    isReadyView: isReadyView,\n    requestPutDownloadOnlyMobile: requestPutDownloadOnlyMobile,\n    incrementNumOfDownloads: incrementNumOfDownloads,\n    prevSrcCollection: prevSrcCollection\n  });\n};\n\n/* harmony default export */ var pages_ImageViewPage = __webpack_exports__["default"] = (Object(es6["a" /* withCookies */])(ImageViewPage));\n\n//# sourceURL=webpack:///./src/pages/ImageViewPage.jsx_+_1_modules?')}}]);