(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"./src/components/pages/ImageViewPage.jsx":function(e,t,s){"use strict";s.r(t);var a=s("./node_modules/react/index.js"),o=s.n(a),n=s("./node_modules/react-cookie/es6/index.js"),i=s("./node_modules/react-router/esm/react-router.js"),l=s("./src/components/contexts/DomContext.jsx"),r=s("./src/components/modules/axios.js"),c=s("./src/components/modules/cacheRoute.jsx"),u=s("./src/components/modules/utils.js"),d=s("./src/components/organisms/ImageView.jsx"),m=s("./src/components/organisms/List/ImageList.jsx"),g=s("./src/components/atoms/BackButton.jsx"),b=s("./src/components/molecules/Headline.jsx");s("./src/components/atoms/Adsense.jsx");var p=e=>{const{groupId:t,blogCt:s,order:a,groupKey:n,imageId:i,images:l,blog:r,status:c,isReadyView:p,requestPutDownloadOnlyMobile:O,incrementNumOfDownloads:f,prevSrcCollection:j}=e;return o.a.createElement(o.a.Fragment,null,u.u&&o.a.createElement(b.a,{title:"画像詳細"}),!u.u&&o.a.createElement(g.a,{fixed:!0,className:"in-image-view"}),o.a.createElement(d.a,{groupId:t,blogCt:s,order:a,groupKey:n,imageId:i,images:l,blog:r,status:c,isReadyView:p,requestPutDownloadOnlyMobile:O,incrementNumOfDownloads:f,prevSrcCollection:j}),o.a.createElement("div",{className:"container-fluid text-muted mt-3 list-container-fluid"},o.a.createElement(m.b,{type:"RELATED_IMAGES",topComponent:o.a.createElement("h3",{className:"text-center related-image-title "+(u.w?"mt-2":"")},"関連画像")})))},O=s("./src/components/templates/ViewTemplate.jsx");t.default=Object(n.b)(e=>{const{cookies:t}=e,{isCachedRoute:s}=Object(c.a)(),n=t.get("csrftoken"),d=Object(l.e)(),m=Object(l.d)(),g=Object(i.l)(),{groupId:b,blogCt:f,order:j,groupKey:w}=Object(O.c)(),{imageViewUrl:h,blogViewUrl:_}=Object(O.e)(b,f,j),[D]=Object(a.useState)(`${b}-${f}-${j}`),[V]=Object(a.useState)(`${D}.${Object(u.m)()}`),S=void 0!==g.state?g.state.prevSrc:null,v=(e,t,s)=>{"success"===e?Object(u.H)({title:`${t}(${s})｜画像詳細`,description:`${s}のブログ「${t}」の画像です。`}):"blog_not_found"===e&&Object(u.H)({title:"Not Found Blog",description:""})},[I,E,N,C,x,y,k]=Object(O.b)(_,j,v),{incrementNumOfViews:R,incrementNumOfDownloads:q}=Object(O.d)(I,E),{request:K}=Object(r.a)(h,"put",{data:{action:"view",key:x},csrftoken:n,thenCallback:e=>{"success"==e.data.status&&R(j)},limitRequest:1}),{request:M}=Object(r.a)(h,"put",{data:{action:"download",key:y},csrftoken:n,thenCallback:e=>{"success"==e.data.status&&q(j)}});return Object(a.useEffect)(()=>{var e;!s&&k&&(d.accessedImages.includes(V)||(K(),m({type:"ACCESS_TO_IMAGE",imageId:V})),null!=N&&null!==(e=N.writer)&&void 0!==e&&e.name&&v(C,N.title,N.writer.name))},[s,k]),o.a.createElement(p,{groupId:b,blogCt:f,order:j,groupKey:w,imageId:D,images:I,blog:N,status:C,isReadyView:k,requestPutDownloadOnlyMobile:M,incrementNumOfDownloads:q,prevSrcCollection:S})})},"./src/components/templates/ViewTemplate.jsx":function(e,t,s){"use strict";s.d(t,"c",(function(){return m})),s.d(t,"e",(function(){return g})),s.d(t,"b",(function(){return b})),s.d(t,"d",(function(){return p}));var a=s("./node_modules/react/index.js"),o=s.n(a),n=s("./node_modules/axios/index.js"),i=s.n(n),l=s("./src/components/modules/utils.js"),r=s("./src/components/modules/env.js"),c=s("./node_modules/react-router/esm/react-router.js"),u=s("./src/components/modules/axios.js");class d extends o.a.Component{constructor(e){super(e);const t=e.match.params.groupID,s=e.match.params.blogCt;this.initState={group:Object(l.o)(t),groupID:t,blogCt:s,title:"",postDate:"",writer:{},numOfViews:0,numOfDownloads:0,officialUrl:"",url:"",images:[],status:"",progress:0,loadingImageUrl:"",VIEW_KEY:"",DOWNLOAD_KEY:""},this.state=this.initState,this.blogViewURL=Object(l.a)(r.b,"blog/",this.state.groupID,this.state.blogCt),this.incrementNumOfViews=this.incrementNumOfViews.bind(this),this.incrementNumOfDownloads=this.incrementNumOfDownloads.bind(this)}getBlog(){setTimeout(()=>{i.a.get(this.blogViewURL).then(e=>{let t={};this.state.status||"blog_not_found"===e.data.status||(t={title:e.data.title,postDate:e.data.post_date,writer:e.data.writer,numOfViews:e.data.num_of_views,numOfDownloads:e.data.num_of_downloads,officialUrl:e.data.official_url,url:e.data.url}),"success"===e.data.status?void 0!==this.props.order&&e.data.images.length<=this.props.order?(this.setState(Object.assign({status:"get_image_failed"},t)),this.updateMetaVerView("get_image_failed")):(this.setState(Object.assign({images:e.data.images.map(e=>Object(l.f)(e)),status:"success",VIEW_KEY:e.data.VIEW_KEY,DOWNLOAD_KEY:e.data.DOWNLOAD_KEY},t)),this.updateMetaVerView("success",t.title,t.writer.name)):"start_download"===e.data.status||"downloading"===e.data.status?(this.setState(Object.assign({progress:e.data.progress,loadingImageUrl:e.data.loading_image,status:"accepted"},t)),this.updateMetaVerView("accepted")):"blog_not_found"===e.data.status?(this.setState({status:"blog_not_found",title:"ブログが見つかりませんでした。"}),this.updateMetaVerView("blog_not_found")):"get_image_failed"===e.data.status&&(this.setState(Object.assign({status:"get_image_failed"},t)),this.updateMetaVerView("get_image_failed"))}).catch(e=>{console.error(e)}).finally(()=>{Object(l.s)(this.props.location.pathname)})},r.j)}incrementNumOfViews(e=-1){e<0?this.setState(e=>({numOfViews:e.numOfViews+1})):this.setState(t=>{let s=t.images;return s.length>e&&(s[Number(e)].numOfViews+=1),{images:s}})}incrementNumOfDownloads(e=-1,t=1){e<0?this.setState(e=>({numOfDownloads:e.numOfDownloads+t})):this.setState(s=>{let a=s.images;return a.length>e&&(a[Number(e)].numOfDownloads+=t),{images:a}})}componentDidMount(){this.getBlog()}componentDidUpdate(e,t){t.status!==this.state.status&&"accepted"===this.state.status&&(this.reqCount=0,this.intervalReqID=setInterval(()=>{this.reqCount++<=20?this.getBlog():(this.setState({status:"get_image_failed"}),clearInterval(this.intervalReqID))},1e3)),t.status!==this.state.status&&"accepted"===t.status&&clearInterval(this.intervalReqID)}componentWillUnmount(){clearInterval(this.intervalReqID)}}t.a=d;const m=()=>{var e,t,s;const o=Object(c.n)(),[n]=Object(a.useState)(null==o||null===(e=o.params)||void 0===e?void 0:e.groupId),[i]=Object(a.useState)(null==o||null===(t=o.params)||void 0===t?void 0:t.blogCt),[r]=Object(a.useState)(null==o||null===(s=o.params)||void 0===s?void 0:s.order),[u]=Object(a.useState)(Object(l.o)(n));return{groupId:n,blogCt:i,order:r,groupKey:u}},g=(e,t,s)=>{const[o]=Object(a.useState)(Object(l.a)(r.b,"image/",e,t,s)),[n]=Object(a.useState)(Object(l.a)(r.b,"blog/",e,t));return{imageViewUrl:o,blogViewUrl:n}},b=(e,t,s)=>{const o=Object(c.l)(),[n,i]=Object(a.useState)(),[r,d]=Object(a.useState)(),[m,g]=Object(a.useState)(""),[b,p]=Object(a.useState)(""),[O,f]=Object(a.useState)(""),[j,w]=Object(a.useState)(!1);return Object(u.a)(e,"get",{thenCallback:e=>{let a={};m||"blog_not_found"===e.data.status||(a=Object(l.g)({...e.data})),"success"===e.data.status?void 0!==t&&e.data.images.length<=t?(g("get_image_failed"),d(a),s("get_image_failed")):(d(a),i(e.data.images.map(e=>Object(l.g)(e))),g("success"),p(e.data.VIEW_KEY),f(e.data.DOWNLOAD_KEY),s("success",a.title,a.writer.name)):"blog_not_found"===e.data.status&&(g("blog_not_found"),s("blog_not_found"))},finallyCallback:()=>{Object(l.s)(o.pathname)},shouldRequestDidMount:!0}),Object(a.useEffect)(()=>{!j&&void 0!==n&&void 0!==r&&"string"==typeof m&&m.length>0&&"string"==typeof b&&b.length>0&&"string"==typeof O&&O.length>0&&w(!0)},[n,r,m,b,O]),[n,i,r,m,b,O,j]},p=(e,t)=>{const[s,o]=Object(a.useState)(0),[n,i]=Object(a.useState)(0);return{numOfViewsOnlyBlog:s,incrementNumOfViews:(a=-1)=>{if(a<0)o(s+1);else{let s=[...e];s.length>a&&(s[Number(a)].numOfViews+=1,t(s))}},numOfDownloadsOnlyBlog:n,incrementNumOfDownloads:(s=-1,a=1)=>{if(s<0)i(n+a);else{let o=[...e];o.length>s&&(o[Number(s)].numOfDownloads+=a,t(o))}}}}}}]);